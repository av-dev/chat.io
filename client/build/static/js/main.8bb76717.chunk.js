(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{5583:function(e,t,n){e.exports=n(5959)},5822:function(e,t){},5957:function(e,t,n){},5959:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),o=n(31),i=n.n(o),c=(n(5588),n(83)),s=n(60),u=n(289),l=n(53),d="__START",h="__FAIL",f={user:null,loading:!1,loaded:!1},p={contacts:null,error:null,loading:!0,loaded:!0},m=Object(s.c)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_AUTH"+d:case"LOGOUT"+d:return Object(l.a)({},e,{loading:!0});case"GET_AUTH__SUCCESS":return Object(l.a)({},e,{user:t.payload,error:null,loading:!1,loaded:!0});case"GET_AUTH"+h:return Object(l.a)({},e,{error:t.error,user:null,loading:!1});case"LOGOUT__SUCCESS":return Object(l.a)({},e,{error:null,user:null,loading:!1,loaded:!1});case"LOGOUT"+h:return Object(l.a)({},e,{error:t.error,loading:!1});default:return e}},app:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_CONTACTS"+d:return Object(l.a)({},e,{loading:!0});case"GET_CONTACTS__SUCCESS":return Object(l.a)({},e,{contacts:t.payload,error:null,loading:!1,loaded:!0});case"GET_CONTACTS"+h:return Object(l.a)({},e,{error:t.error,contacts:null,loading:!1});default:return e}}}),g=n(40),v=n.n(g),b=n(131),w=n(71),y=n(7),O=y.c(y.n,y.i);y.c(y.n,y.h),y.e(function(e,t){return y.m(function(e){return y.r(y.l(e),t)},e)});function E(e){return Promise.resolve(e).then(function(e){if(O(e.error))return[void 0,e.error];if(O(e.data.message))return[e.data];var t=new Error("Rejection with empty 'response.data.message' value");return t.originalValue=t,[void 0,t]}).catch(function(e){if(Object(y.i)(e)){var t=new Error("Rejection with empty value");t.originalValue=t,e=t}return Object(y.i)(e.error)?[void 0,e]:[void 0,e.error]})}var j=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||s.d,k=Object(s.e)(m,j(Object(s.a)(u.a,function(e){return function(t){return function(){var n=Object(w.a)(v.a.mark(function n(r){var a,o,i,c,s,u;return v.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(a=r.promise,o=r.type,!a){n.next=13;break}return e.dispatch({type:o+d}),n.next=5,E(a);case 5:i=n.sent,c=Object(b.a)(i,2),s=c[0],u=c[1],s&&e.dispatch({type:o+"__SUCCESS",payload:s.message}),u&&e.dispatch({type:o+h,error:u}),n.next=14;break;case 13:t(r);case 14:case"end":return n.stop()}},n,this)}));return function(e){return n.apply(this,arguments)}}()}}))),C=n(48),S=n(49),T=n(51),x=n(50),_=n(52),L=(n(5794),n(47)),U=n(293),A=n(290),R=n.n(A),N=n(291),G=n.n(N),I=n(21),D=n(130),F="userConnect",M="message",W="createRoom",H=n(94),B=n(294),P=n(3),V=n.n(P),q=n(9),Y=n.n(q),z=n(190),J=function(e){function t(){var e,n;Object(C.a)(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=Object(T.a)(this,(e=Object(x.a)(t)).call.apply(e,[this].concat(o)))).ref=a.a.createRef(),n}return Object(_.a)(t,e),Object(S.a)(t,[{key:"componentDidUpdate",value:function(e,t){var n=this.props.messages,r=this.ref.current;e.messages.length!==n.length&&r&&(r.scrollTop=r.scrollHeight-r.offsetHeight)}},{key:"render",value:function(){var e=this.props,t=e.messages,n=e.render,r=Object(B.a)(e,["messages","render"]);return a.a.createElement(I.j,{rootRef:this.ref},a.a.createElement(I.g,r,t.map(n)))}}]),t}(r.Component),X=Object(L.withStyles)({currentUser:{textAlign:"right","&>*:nth-child(1)":{order:2},"&>*:nth-child(2)":{order:1}},secondary:{fontSize:13},primary:{fontSize:14}})(function(e){var t=e.message,n=e.date,r=e.author,o=e.classes,i=e.hasCurrentUser;return a.a.createElement(z.Motion,{defaultStyle:{fade:0},style:{fade:Object(z.spring)(1)}},function(e){var c,s=e.fade;return a.a.createElement(I.m,{title:n,placement:"right"},a.a.createElement(I.h,{style:{opacity:s},className:Y()((c={},Object(H.a)(c,o.item,!0),Object(H.a)(c,o.currentUser,i),c))},a.a.createElement(I.b,{srcSet:function(e){var t=y.o(["photos",0,"value"],e);return e&&t}(r)}),a.a.createElement(I.i,{inset:!0,primary:r.name,secondary:t,classes:{secondary:o.secondary,primary:o.primary}})))})});X.propTypes={message:V.a.string.isRequired,date:V.a.string.isRequired,author:V.a.object.isRequired};var K={List:J,ListItem:X},Q=function(e){function t(){var e,n;Object(C.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(T.a)(this,(e=Object(x.a)(t)).call.apply(e,[this].concat(a)))).state={value:"",socket:!1,messages:[]},n.handleSocketConnect=function(e){var t=n.props,r=t.auth,a=t.getContacts;n.setState({socket:e}),n.handleSocketEvents(e),a(),e.emit(F,r.user.id)},n.handleChange=function(e){n.setState({value:e.target.value})},n.sendMessage=function(){var e=n.state,t=e.socket,r=e.value,a=n.props.auth.user;t.emit(M,{message:r,author:a.id}),n.setState({value:null}),n.field.focus()},n.handleEnter=function(e){"Enter"===e.key&&(e.preventDefault(),n.sendMessage())},n.handleCreateRoom=function(){n.state.socket.emit(W,{name:"new Room",members:[]})},n.handleShowContacts=function(){console.info(n.props.app.contacts)},n.setFieldRef=function(e){return n.field=e},n}return Object(_.a)(t,e),Object(S.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=R()();t.on("connect",function(){return e.handleSocketConnect(t)}),t.on("disconnect",function(){return function(e){e.removeListener(M).removeListener(W),console.info("Removed socket listeners")}(t)})}},{key:"componentWillUnmount",value:function(){this.state.socket.disconnect(),this.state.socket.disconnect()}},{key:"handleSocketEvents",value:function(e){var t=this;e.on(M,function(e){t.setState(function(t){return{messages:Object(U.a)(t.messages).concat([e])}})}),e.on(W,console.info)}},{key:"getContact",value:function(e){return this.props.app.contacts.find(y.p("id",e))}},{key:"isConnected",value:function(){var e=this.state.socket;return e&&e.connected}},{key:"valueIsFilled",value:function(){var e=this.state.value;if(e)return e.trim().length}},{key:"getControls",value:function(e){var t=e&&this.valueIsFilled();return a.a.createElement(r.Fragment,null,a.a.createElement(I.f,{onClick:this.sendMessage,disabled:!t},a.a.createElement(D.b,null)))}},{key:"render",value:function(){var e=this.props,t=e.classes,n=e.auth.user,r=this.state,o=r.value,i=r.messages,c=this.isConnected();return a.a.createElement(I.e,{container:!0,spacing:24,className:t.container},a.a.createElement(I.e,{item:!0,xs:12,className:t.content},a.a.createElement(K.List,{className:t.messages,messages:i,render:function(e){var t=e.author,r=e.message,o=e.date;return a.a.createElement(K.ListItem,{key:r+o,message:r,date:G()(o).format("HH:mm:ss DD.MM.YYYY"),author:t,hasCurrentUser:t.id===n.id})}}),a.a.createElement("div",{className:t.fieldContainer},a.a.createElement(I.k,{multiline:!0,rowsMax:4,label:"Text message",className:t.textField,value:o||"",onChange:this.handleChange,margin:"normal",variant:"outlined",disabled:!c,inputRef:this.setFieldRef,onKeyPress:this.handleEnter}),this.getControls(c))))}}]),t}(r.Component),$=Object(L.withStyles)({textField:{flexGrow:1,margin:"10px 5px 10px 0"},container:{width:"80%",minWidth:600,maxWidth:"100%",margin:"20px auto",flexGrow:1},content:{position:"relative",paddingBottom:100,display:"flex",flexFlow:"column nowrap"},fieldContainer:{display:"flex",alignItems:"center",background:"#fff",flexShrink:0},messages:{flexGrow:1,overflow:"auto"}})(Q);function Z(){return(Z=Object(w.a)(v.a.mark(function e(t){var n,r,a,o;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.url,r=t.method,a=void 0===r?"GET":r,e.next=3,fetch(n,{method:a});case 3:o=e.sent,e.t0=o.status,e.next=200===e.t0?7:201===e.t0?7:202===e.t0?7:10;break;case 7:if("application/json"!==o.headers.get("content-type").slice(0,16)){e.next=9;break}return e.abrupt("return",o.json());case 9:return e.abrupt("return",o.text());case 10:if("application/json"!==o.headers.get("content-type").slice(0,16)){e.next=14;break}return e.next=13,o.json();case 13:throw e.sent;case 14:throw new Error("\u0421\u0435\u0440\u0432\u0435\u0440 \u043d\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0438\u0439!");case 15:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}var ee=function(e,t){return function(e){return Z.apply(this,arguments)}({url:e+te(t)})},te=y.g(O,y.c(y.s(y.k,y.d("?")),y.j("&"),y.m(function(e){return"".concat(encodeURIComponent(e[0]),"=").concat(encodeURIComponent(e[1]))}),y.q,y.f(O)),y.a("")),ne=Object(c.b)(function(e){return{auth:e.auth,app:e.app}},{getContacts:function(){return function(){var e=Object(w.a)(v.a.mark(function e(t){var n,r,a,o;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:"GET_CONTACTS"+d}),e.next=3,E(ee("/users"));case 3:n=e.sent,r=Object(b.a)(n,2),a=r[0],o=r[1],a&&t({type:"GET_CONTACTS__SUCCESS",payload:a.message}),o&&t({type:"GET_CONTACTS"+h,error:o});case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}})(function(e){var t=e.auth.user;return t&&t.id?a.a.createElement($,e):null}),re=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.name,r=t.width,a=t.height,o=window.outerHeight/2-a/2,i=window.outerWidth/2-r/2,c=window.open(e,n,"width=".concat(r,", height=").concat(a,", top=").concat(o,", left=").concat(i));return window.focus&&c.focus(),c},ae=function(e){return(Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_SERVER||"").concat(e)},oe=function(e){function t(){var e,n;Object(C.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(T.a)(this,(e=Object(x.a)(t)).call.apply(e,[this].concat(a)))).onLogout=function(){return n.props.logout()},n.onUserClick=function(){var e=y.o(["auth","user","googleID"],n.props);window.open("https://plus.google.com/".concat(e),"_blank")},n.onLogin=function(e){e.data&&n.props.getAuth(),window.removeEventListener("message",n.onLogin)},n.handleLogin=function(){re(ae("/auth"),{name:"loginWindow",width:400,height:500}),window.addEventListener("message",n.onLogin)},n}return Object(_.a)(t,e),Object(S.a)(t,[{key:"componentDidMount",value:function(){this.props.getAuth()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("message",this.onLogin)}},{key:"isAuthenticated",value:function(){var e=this.props.auth;return e&&e.user}},{key:"getUserInfo",value:function(){var e=this.props,t=e.auth,n=e.classes,r=y.o(["user","photos",0,"value"],t),o=y.o(["user","name"],t);return a.a.createElement(I.d,{avatar:a.a.createElement(I.b,{srcSet:r,alt:o}),label:o,onDelete:this.onLogout,onClick:this.onUserClick,className:n.chip})}},{key:"getLoginButton",value:function(){var e=this.props.classes;return a.a.createElement(r.Fragment,null,a.a.createElement(I.c,{color:"primary",className:e.login,onClick:this.handleLogin},"Login"))}},{key:"render",value:function(){return this.isAuthenticated()?this.getUserInfo():this.getLoginButton()}}]),t}(r.Component),ie=Object(L.withStyles)({chip:{backgroundColor:"rgba(255,255,255,.5)","&:hover":{backgroundColor:"rgba(255,255,255,.8)"}},login:{color:"#fff"}})(oe),ce={getAuth:function(){return{promise:ee("/auth/user"),type:"GET_AUTH"}},logout:function(){return{promise:ee("/auth/logout"),type:"LOGOUT"}}},se=Object(c.b)(function(e){return{auth:e.auth}},ce)(ie),ue=function(e){function t(){return Object(C.a)(this,t),Object(T.a)(this,Object(x.a)(t).apply(this,arguments))}return Object(_.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this.props.classes;return a.a.createElement(I.a,{position:"static"},a.a.createElement(I.l,null,a.a.createElement(I.f,{color:"inherit","aria-label":"Menu"},a.a.createElement(D.a,null)),a.a.createElement(I.n,{variant:"title",color:"inherit"},"Chat.io"),a.a.createElement("div",{className:e.grow}),a.a.createElement(se,null)))}}]),t}(r.Component),le=Object(L.withStyles)({grow:{flexGrow:1}})(ue),de=function(e){function t(){return Object(C.a)(this,t),Object(T.a)(this,Object(x.a)(t).apply(this,arguments))}return Object(_.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this.props.classes;return a.a.createElement("div",{className:e.root},a.a.createElement(le,null),a.a.createElement(ne,null))}}]),t}(r.Component),he=Object(L.withStyles)({root:{height:"100vh",display:"flex",flexFlow:"column nowrap"}})(de),fe=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function pe(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}n(5957);i.a.render(a.a.createElement(c.a,{store:k},a.a.createElement(he,null)),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("","/service-worker.js");fe?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):pe(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):pe(e)})}}()}},[[5583,2,1]]]);
//# sourceMappingURL=main.8bb76717.chunk.js.map